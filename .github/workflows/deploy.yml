name: ğŸš€ Deploy VitePress

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        
      - name: ğŸ” è°ƒè¯•ï¼šæŸ¥çœ‹é¡¹ç›®ç»“æ„
        run: |
          echo "=== é¡¹ç›®ç»“æ„ ==="
          find . -type f -name "*.json" | head -10
          echo "=== docsç›®å½• ==="
          ls -la docs/
          
      - name: ğŸ› ï¸ è®¾ç½®Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          echo "è¿›å…¥docsç›®å½•å®‰è£…ä¾èµ–..."
          cd docs
          npm ci
          
      - name: ğŸ”¨ å°è¯•å„ç§æ„å»ºå‘½ä»¤
        run: |
          echo "=== å°è¯•æ„å»º ==="
          cd docs
          
          # æ–¹æ³•1ï¼šæŸ¥çœ‹å¯ç”¨çš„scripts
          echo "å¯ç”¨çš„npm scripts:"
          npm run || echo "æ— æ³•è·å–scripts"
          
          # # æ–¹æ³•2ï¼šå°è¯•å¸¸è§æ„å»ºå‘½ä»¤
          # echo "å°è¯•æ„å»º..."
          # if grep -q '"build"' package.json; then
          #   echo "æ‰§è¡Œ npm run build"
          #   npm run build
          # elif grep -q '"docs:build"' package.json; then
          #   echo "æ‰§è¡Œ npm run docs:build"
          #   npm run docs:build
          # elif grep -q '"build:docs"' package.json; then
          #   echo "æ‰§è¡Œ npm run build:docs"
          #   npm run build:docs
          # else
          #   echo "å°è¯•é»˜è®¤æ„å»º"
          #   npx vitepress build
          # fi
          
      - name: ğŸ“ æ£€æŸ¥æ„å»ºç»“æœ
        run: |
          echo "=== æ£€æŸ¥æ„å»ºè¾“å‡º ==="
          # æ£€æŸ¥å¯èƒ½çš„è¾“å‡ºç›®å½•
          if [ -d "docs/.vitepress/dist" ]; then
            echo "âœ… æ‰¾åˆ°: docs/.vitepress/dist"
            ls -la docs/.vitepress/dist/
          fi
          
          if [ -d "docs/dist" ]; then
            echo "âœ… æ‰¾åˆ°: docs/dist"
            ls -la docs/dist/
          fi
          
          if [ -d "_site" ]; then
            echo "âœ… æ‰¾åˆ°: _site"
            ls -la _site/
          fi
          
      - name: ğŸš€ éƒ¨ç½²åˆ°GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # å…ˆå°è¯•æœ€å¸¸è§çš„è·¯å¾„
          publish_dir: docs/.vitepress/dist